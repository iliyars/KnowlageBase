
### Миграция в команной строке

Package Manager Console
```cmd
Add-Migration MigrationName [options]
```
Для использования этого подхода необходимо установить Nuget-пакет `Microsoft.EntityFrameworkCore.Tools` в проект с `DbContex`.

Developwer PowerShell
```cmd
dotnet ef migrations add MigrationName [options]
```
Для этой команды необходимо установаить .NET Core SDK

### Как иструменты для миграции получают копию DbContext`a приложения
Команда мграции пытается создать объект DbContext приложения с помощью конструктора без параметров. Но если у класса DbContext нет конструктора без параметров, как например в ASP.NET приложениях - нужно создать класс-фабрику, реализующий интерфейс `IDesignedTimeContextFactory<T>`, который будкт создавать класс DbContext.

```cs
public class ContextFactoryNeededForMigrations : IdesignedTimeContextFactory<EfCoreContext>
{
	private const string ConnectionString = "Data sourece=test.db";
	/// Команда Add-Migration вызовет этот метод для создания объекта DbContext
	public EfCoreContext CreateDbContext(string[] args)
	{
		///Создаем OptionsBuilder для конфигурирования параметров базы данных
		var optionsBuilder = new DbContextOPtionsBuilder<EfCoreContext>();
		optionsBuiler.UseSqlite(ConnectionString)
		return new EfCoreContext(optionsBuilder.Options);
	}
}
```

### Обновление базы данных после миграции
Есть несколько способов обновить базу данных:
1. Sql change script 
2. вызов Database.Migrate из главного приложения
3. команда `Update-database` в PMC или `dotnet ef update`

Рекомендуется использовать первй метод. Так как `Database.Migrate`  не имеет паралельной версии и в случае множества миграций - они буд исполняться одна за одной при запуске программы.